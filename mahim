#!/bin/bash
# Generated by Gemini

# --- Terminal Colors & Control (Using Tput for Reset) ---
R="\e[1;31m"  # Bright Red
G="\e[1;32m"  # Green
Y="\e[1;33m"  # Yellow
B="\e[1;34m"  # Blue (Not used, but kept for completeness)
C="\e[1;36m"  # Cyan
W="\e[1;37m"  # White
N="\e[0m"     # Reset
DASH_LINE="${R}$(printf -- '-%.0s' {1..60})${N}"
BOLD_RED_ARROW="${R}»»${W}"

# --- Utility Functions ---

# Function to display the mahim NETWORK ASCII Art
print_mahim_logo() {
    local BORDER="${R}==============================================================${N}"
    local WING="${W}>>>${R} ${W}"
    echo -e "\n${BORDER}"
    echo -e "${R}# ${WING}    ____  _   _ ____  _   _ _   _ ____  _   _ _____   ${R}#"
    echo -e "${R}# ${WING}   / ___|| | | |  _ \| | | | \ | |  _ \| \ | |_   _|  ${R}#"
    echo -e "${R}# ${WING}  | |   | |_| | |_) | | | |  \| | | | |  \| | | |    ${R}#"
    echo -e "${R}# ${WING}  | |___|  _  |  _ <| |_| | |\  | |_| | |\  | | |    ${R}#"
    echo -e "${R}# ${WING}   \____|_| |_|_| \_\\___/|_| \_|____/|_| \_| |_|    ${R}#"
    echo -e "${R}# ${WING}                                                      ${R}#"
    echo -e "${R}# ${Y}            mahim - X Y Z                                 ${R}#"
    echo -e "${BORDER}\n"
}

# Function to create a consistent, centered box/header
print_centered_header() {
    local text="$1"
    local color="${2:-$R}" # Default to Red
    local len="${#text}"
    local width=60
    local padding=$(( (width - len) / 2 ))
    
    echo -e "${color}$(printf -- '═%.0s' {1..60})${N}"
    printf "${color}║%*s${W}%s${color}%*s║${N}\n" $padding "" "$text" $((padding + (len % 2))) ""
    echo -e "${color}$(printf -- '═%.0s' {1..60})${N}"
}

# Function to display a menu option in a clean block
print_menu_option() {
    local num="$1"
    local text="$2"
    local width=54 # Width of the content area
    local len_text="${#text}"
    local pad_size=$(( width - len_text - 5 )) # 5 is for '[NUM]' and spaces
    
    echo -e "  ${R}┌$(printf -- '─%.0s' {1..58})┐${N}"
    echo -e "  ${R}│ ${W} [${R}$num${W}] ${Y}$text$(printf '%*s' $pad_size) ${R}│${N}"
    echo -e "  ${R}└$(printf -- '─%.0s' {1..58})┘${N}"
}

# Function to display status messages
print_status() {
    local text="$1"
    local color="${2:-$R}" # Default to Red
    echo -e "\n${color}»»${W} ${text}${N}\n"
}

# Function for the Main Screen
main_menu() {
    clear
    print_mahim_logo
    print_centered_header "DEVELOPMENT MANAGEMENT CONSOLE" $R
    
    # Main Options Header
    echo -e "\n${R}╔$(printf -- '═%.0s' {1..58})╗${N}"
    echo -e "${R}║${Y}            M A I N   O P T I O N S               ${R}║${N}"
    echo -e "${R}╚$(printf -- '═%.0s' {1..58})╝${N}\n"
    
    # Options
    print_menu_option "1" "IDX Tool Setup (Nix/QEMU)"
    print_menu_option "2" "IDX VPS Maker (Remote Script)"
    print_menu_option "3" "Exit Console"
    
    echo -e "\n${DASH_LINE}"
    echo -ne "${BOLD_RED_ARROW} Select Option [${R}1-3${W}] : ${Y}"
    read -p "" op
    echo -ne "${N}"
}

# --- Main Logic Loop ---
while true; do
    main_menu
    
    case $op in
    
  
    # =========================================================
    # (1) IDX TOOL SETUP
    # =========================================================
    1)
        clear
        print_mahim_logo
        print_status "IDX TOOL SETUP" "$R"
        
        echo -e "${R}─┐${W} Cleaning up old files...${R}└${N}"
        cd
        rm -rf myapp
        rm -rf flutter
        
        cd vps123
        
        if [ ! -d ".idx" ]; then
            echo -e "${G}Creating .idx directory...${N}"
            mkdir .idx
            cd .idx
            
            echo -e "${C}Creating dev.nix configuration...${N}"
            echo -e "${Y}───== Creating dev environment ==───${N}"
            
            cat <<EOF > dev.nix
{ pkgs, ... }: {
  channel = "stable-24.05";

  packages = with pkgs; [
    unzip
    openssh
    git
    qemu_kvm
    sudo
    cdrkit
    cloud-utils
    qemu
  ];

  env = {
    EDITOR = "nano";
  };

  idx = {
    extensions = [
      "Dart-Code.flutter"
      "Dart-Code.dart-code"
    ];

    workspace = {
      onCreate = { };
      onStart = { };
    };

    previews = {
      enable = false;
    };
  };
}
EOF
            
            echo -e "${Y}IDX TOOL SETUP COMPLETE!${N}"
            echo -e "${R}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${N}"
            echo -e "${R}Location: ~/vps123/.idx${W}"
            echo -e "${R}Tool: IDX Development Environment${W}"
            echo -e "${R}Version: Stable 24.05${W}"
            echo -e "${R}━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━${N}"
        else
            echo -e "${R}IDX Tool already setup — skipping.${W}"
            echo -e "${R}Location: ~/vps123/.idx${W}"
        fi
        
        echo -e "\n${R}─────────────────────────────────────${N}"
        echo -ne "${R}Press Enter to return to main menu...${N}"
        read -p ""
        ;;

    # =========================================================
    # (2) IDX VPS MAKER
    # =========================================================
    2)
        clear
        print_mahim_logo
        print_centered_header "IDX VPS MAKER" $R
        
        print_status "Connecting to mahim Network Remote Script..." $C
        
        echo -e "${C}»» Executing remote script via curl...${N}"
        echo -e "${DASH_LINE}"
        
        # Execute the remote script
        bash script
        
        echo -e "\n${DASH_LINE}"
        print_status "IDX VPS Maker execution completed." $R
        read -p "Press Enter to return to main menu..."
        ;;

    # =========================================================
    # (4) EXIT
    # =========================================================
    3)
        clear
        print_mahim_logo
        print_centered_header "SESSION TERMINATED" $R
        
        echo -e "\n${R}┌$(printf -- '─%.0s' {1..58})┐${N}"
        echo -e "${R}│ ${W}   Thank you for using Mahim VPS CODE!    ${R}│${N}"
        echo -e "${R}│ ${Y}            Made with ❤️ by mahim                 ${R}│${N}"
        echo -e "${R}└$(printf -- '─%.0s' {1..58})┘${N}\n"
        
        echo -e "${Y}Goodbye! Come back soon...${N}\n"
        exit 0
        ;;

    # =========================================================
    # INVALID OPTION
    # =========================================================
    *)
        clear
        print_mahim_logo
        print_centered_header "INVALID OPTION!" $Y
        
        echo -e "\n${R}┌$(printf -- '─%.0s' {1..58})┐${N}"
        echo -e "${R}│ ${W}    Please choose a number between 1 and 4 only!    ${R}│${N}"
        echo -e "${R}└$(printf -- '─%.0s' {1..58})┘${N}"
        
        sleep 2
        ;;
    esac
done
